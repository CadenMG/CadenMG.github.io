<!doctypehtml>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Creating Python Extensions with Rust</title>

  <meta name="viewport"content="width=device-width,initial-scale=1">
  <meta http-equiv="X-UA-Compatible"content="ie=edge">

  <link rel="shortcut icon"href="../assets/favicon.ico"type="image/x-icon">
  <link rel="preload"href="../styles/article.css"as="style">
  <link rel="stylesheet"href="../styles/article.css">
</head>
<body>
  <header id="top-container"role="navigation">
    <nav>
  <a class="logo-link"href="/">
    <h1>Caden Garrett</h1>
    <span>Building @vast.codes ðŸ¦€</span>
  </a>
  <small>
    <a id="about"class="info-link"href="/about.html">ðŸ‘€About</a> /
    <a id="works"class="info-link"href="/works.html">ðŸ”¥Projects</a> /
    <a id="articles"class="info-link"href="/articles.html">ðŸ“šBlog Posts</a>
  </small>
</nav>

  </header>
  <main id="main-container">
    <article id="article-container">
      <h1 id="article-title">
        Creating Python Extensions with Rust
      </h1>
      
        <h2 id="article-subtitle">
          Utilizing PyO3 and maturin to create Python Extensions
        </h2>
      
      <time id="article-date">
        2023.06.24
      </time>
      <section id="article-content-container">
        <details><summary>Table of Contents</summary>
<p><div class="table-of-contents"><ul><li><a href="#intro-to-python-extensions">Intro to Python Extensions</a><li><a href="#setup">Setup</a><li><a href="#rust-code">Rust Code</a><li><a href="#build-the-module">Build the module</a><li><a href="#calling-rust-from-python">Calling Rust from Python</a></ul></div><p></p>
</details>
<h1 id="intro-to-python-extensions"tabindex="-1">Intro to Python Extensions</h1>
<p>Python extensions, are modules written in C or C++ that can be dynamically loaded into the Python interpreter. These extensions provide a way to extend the functionality of Python by integrating with existing C/C++ code or accessing low-level system resources. They allow developers to optimize performance-critical sections of their Python code or interact with libraries and APIs written in other languages. Python extensions provide a bridge between Pythonâ€™s high-level dynamic nature and the low-level power and efficiency of compiled languages, enabling seamless integration and enhancing the capabilities of Python applications.</p>
<p>For this example, weâ€™ll write our Python extension in Rust, and use <a href="https://github.com/PyO3/maturin">maturin</a> to generate the C <a href="https://en.wikipedia.org/wiki/Foreign_function_interface">FFI</a>.</p>
<h1 id="setup"tabindex="-1">Setup</h1>
<p>First weâ€™ll need <a href="https://github.com/PyO3/maturin">maturin</a>, which can be installed through pip:
<code>pip install maturin</code></p>
<p>Next, weâ€™ll create a simple Rust project called <code>rust-py</code> that contains everything we need to build the extension with:
<code>maturin new rust-py</code>
and select <code>pyo3</code> for the binding.</p>
<h1 id="rust-code"tabindex="-1">Rust Code</h1>
<p>Now we should see a directory named <code>rust-py</code> with the following structure:</p>
<pre class="hljs"><code>.
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ pyproject.toml
â””â”€â”€ src
    â””â”€â”€ lib.rs
</code></pre>
<p>Examining the <code>src/lib.rs</code>:</p>
<pre class="hljs"><code><span class="hljs-keyword">use</span> pyo3::prelude::*;

<span class="hljs-comment">/// Formats the sum of two numbers as string.</span>
<span class="hljs-meta">#[pyfunction]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">sum_as_string</span>(a: <span class="hljs-type">usize</span>, b: <span class="hljs-type">usize</span>) <span class="hljs-punctuation">-&gt;</span> PyResult&lt;<span class="hljs-type">String</span>&gt; {
    <span class="hljs-title function_ invoke__">Ok</span>((a + b).<span class="hljs-title function_ invoke__">to_string</span>())
}

<span class="hljs-comment">/// A Python module implemented in Rust.</span>
<span class="hljs-meta">#[pymodule]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">rust_py</span>(_py: Python, m: &amp;PyModule) <span class="hljs-punctuation">-&gt;</span> PyResult&lt;()&gt; {
    m.<span class="hljs-title function_ invoke__">add_function</span>(wrap_pyfunction!(sum_as_string, m)?)?;
    <span class="hljs-title function_ invoke__">Ok</span>(())
}
</code></pre>
<h1 id="build-the-module"tabindex="-1">Build the module</h1>
<p>To build and install our Rust code as a Python module, weâ€™ll need to first activate a <a href="https://docs.python.org/3/library/venv.html">Python virtual environment</a>, and run <code>maturin develop</code> from inside the project:</p>
<pre class="hljs"><code>$ source extension/bin/activate
$ cd rust-py
$ maturin develop
...
ðŸ“¦ Built wheel for CPython 3.8 to /tmp/.tmp16Fe0E/rust-py-0.1.0-cp38-cp38-linux_x86_64.whl
ðŸ›  Installed rust-py-0.1.0
</code></pre>
<h1 id="calling-rust-from-python"tabindex="-1">Calling Rust from Python</h1>
<p>Now that the Python module is built and installed within our virtual environment, we can interact with it like any other Python module:</p>
<pre class="hljs"><code><span class="hljs-keyword">import</span> rust_py
<span class="hljs-built_in">print</span>(rust_py.sum_as_string(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>))
</code></pre>
<p>For building more interesting examples, I would recommend reading through the <a href="https://pyo3.rs/v0.11.0/module">official PyO3 user guide</a>.</p>
<p><a href="https://github.com/CadenMG/py-extensions">Full code on GitHub</a></p>

      </section>
      <section id="article-navigation">
        
        
          <div class="article-navigation-item article-navigation-prev">
            <a href="/article/1.html">
              <div class="article-navigation-arrow article-navigation-prev">ï¼ž</div>
              <div class="article-navigation-content article-navigation-prev">
                <p class="article-navigation-title">Calling Python from Rust</p>
                <p class="article-navigation-subtitle">A quick and dirty way to call your Python modules from Rust</p>
              </div>
            </a>
          </div>
        
      </section>
      <section id="article-list-button-container">
        <a href="/articles.html">
          <div id="article-list-button">ðŸ“š</div>
        </a>
      </section>
    </article>
  </main>


